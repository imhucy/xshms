<!--Start Breadcrumb-->
<div class="row">
	<div id="breadcrumb" class="col-xs-12">
		<ol class="breadcrumb">
			<li><a href="index.html">主 页</a></li>
			<li><a href="javascript:;">设置</a></li>
			<li><a href="javascript:;">首页轮播图设置</a></li>
		</ol>
	</div>
</div>
<!--End Breadcrumb-->
<div class="row">
	<div class="col-xs-12">
		<div class="box">
			<div class="box-content">
				<div class="row">
					<div class="col-xs-4">
						<form role="form" method="post" action="/uploadImage" target="frameFile" enctype='multipart/form-data'>
							<div id="btn">
								<h2>请选择添加图片</h2>
								<hr>
								<input id="fulAvatar" name="fulAvatar" type="file" class="form-control" />
							</div>
							<br/>
							<div class="row">
								<div class="col-xs-12">
									<input class="btn btn-info btn-block" id="btnSub" type="submit" value="点击添加图片" />
								</div>
							</div>
						</form>
						<div id="container">
							<iframe id='frameFile' style="border:none;" name='frameFile' ></iframe>
						</div>
					</div>
					<div class="col-xs-8"  style="border-left:1px dashed #000">
						
						<div class="row">
							<div class="col-xs-8 text-center">图片列表</div>
							<div class="col-xs-4 text-center">操作</div>
						</div>
						<div class="row">
							<hr>
						</div>
						<div class="row" id="imageList">
							
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script>
jQuery(document).ready(function($) {
	$('.preloader').hide();
	loadImageList();
	$('#frameFile').load(function(){
		var response = this.contentWindow.document.body.innerHTML;
		loadImageList();
	})
	$('#btnSub').on('click',function(){		   
    var fulAvatarVal = $('#fulAvatar').val(),  
        errorTip = '<div id="errorTip" class="alert alert-warning">{0}</div> ';  

    $("#errorTip,#alt_warning").remove();
    
    if(fulAvatarVal.length == 0)
    {
      $("#container").prepend(errorTip.format('请选择要上传的文件'));								
      return false;
    }

    var extName = fulAvatarVal.substring(fulAvatarVal.lastIndexOf('.'),fulAvatarVal.length).toLowerCase();

    if(extName != '.png' && extName != '.jpg'){
      $("#container").prepend(errorTip.format('只支持png和jpg格式图片'));							 
      return false;
    }
    return true;
  });

	$('#imageList').on('click', '.deleteBtn', function(e) {
		var id = $(this).val();
		$.post('/remove/index_image', {id: id}, function(data, textStatus, xhr) {
			var json = $.parseJSON(data);
			console.log(json);
			loadImageList();
		});
	});
});


String.prototype.format = function (args) {
  var result = this;
  if (arguments.length > 0) {
    if (arguments.length == 1 && typeof (args) == "object") {
      for (var key in args) {
        if (args[key] != undefined) {
          var reg = new RegExp("({" + key + "})", "g");
          result = result.replace(reg, args[key]);
        }
      }
    }
    else {
      for (var i = 0; i < arguments.length; i++) {
        if (arguments[i] != undefined) {
          var reg = new RegExp("({)" + i + "(})", "g");
          result = result.replace(reg, arguments[i]);
        }
      }
    }
  }
  return result;
}


function loadImageList () {
	$.getJSON('/all/index_image', function(json, textStatus) {
		console.log(json);
		var html = ''
		$.each(json, function(i, item) {
			var template = [
				'<div class="col-xs-8">',
				'	<img width="100" height="40" src="/FRONT/img/index_image/'+ item.image +'" alt="">',
				'	<hr>',
				'</div>',
				'<div class="col-xs-4">',
				'	<button value="'+item.id+'" class="btn btn-info deleteBtn"> 删 除 图 片 <i class="fa fa-trash-o"></i></button>',
				'</div>	'
			].join('');
			html += template;
		});
		$('#imageList').html( html );
	});
}
</script>